---
title: "Linear Regression"
author: "Deepanshu Goyal"
date: "March 4, 2020"
output: html_document
---
```{r}
rm(list = ls())
library(ggplot2)
library(dplyr)
library(corrplot)
library(PerformanceAnalytics)
library(car)
```

# Step1: Read data from the csv file 
# - Check total number of features
# - How many are columns are factor or integers
# - Columns containing large number of null values
```{r Data}
dataset = read.csv("train.csv")
dim(dataset)
table(sapply(dataset,class))
summary(dataset)

```

# Step 2: Data Cleaning
# Remove columns with more than high number of NAs in the dataset
# Remove rows conatins atleast 1 NAs
```{r Data Cleanup}
new_dataset = within(dataset,rm('Id','LotFrontage','Alley','FireplaceQu','MiscFeature','Fence','PoolQC'))
cleaned_data = na.omit(new_dataset)
dim(cleaned_data)
table(sapply(cleaned_data,class))

```

#Step 3: Visualize the dependent variable, as per the linear regression assumption it should follow normal distribution

```{r}
# Visualize the dependent variable and check its skewness abd Kurtosis
hist(cleaned_data$SalePrice,main = "Histogram of Sales Price", xlab = "Sales Price")
skewness(cleaned_data$SalePrice)
kurtosis(cleaned_data$SalePrice)

#Q-Q plot to check normality in the dependent variable
qqnorm(cleaned_data$SalePrice,main = "Q-Q plot of of Sales price")
qqline(cleaned_data$SalePrice)

dim(cleaned_data)

```

#Step3 : Understand relationship between dependent variable and all the independent variables (Numeric Columns) using correlation
```{r}
num_dataset = select_if(cleaned_data, is.numeric)
corr = cor(num_dataset)
corrplot(corr,type ='full',method = 'number',order ='FPC',tl.col = 'black',number.cex = 0.5)
```

#Step4: Draw scatter plots to validate the rlationship between dependent variable and independent variables
```{r}
# Scatter plot between Sales price & Overall Quality
plot(cleaned_data$OverallQual,cleaned_data$SalePrice)

# Scatter plot between Sales price & Above the ground area
plot(cleaned_data$GrLivArea,cleaned_data$SalePrice)

# Scatter plot between Sales price & Garaze size in terms of cars
plot(cleaned_data$GarageCars,cleaned_data$SalePrice)
     
# Scatter plot between Sales price & Gararge Area
plot(cleaned_data$GarageArea,cleaned_data$SalePrice)

# Scatter plot between Sales price & Full Bathroom
plot(cleaned_data$FullBath,cleaned_data$SalePrice)

# Scatter plot between Sales price & Total square feet of basement area
plot(cleaned_data$TotalBsmtSF,cleaned_data$SalePrice)


# Scatter plot between Sales price & First Floor Square feet area
plot(cleaned_data$X1stFlrSF,cleaned_data$SalePrice)

# Scatter plot between Sales price & Total rooms above grade (does not include bathrooms)
plot(cleaned_data$TotRmsAbvGrd,cleaned_data$SalePrice)


# Scatter plot between Sales price & Original construction date
plot(cleaned_data$YearBuilt,cleaned_data$SalePrice)

# Scatter plot between Sales price & Garage construction date
plot(cleaned_data$GarageYrBlt,cleaned_data$SalePrice)

# Scatter plot between Sales price & Remodel date
plot(cleaned_data$YearRemodAdd,cleaned_data$SalePrice)

# Scatter plot between Sales price & Masonry veneer area in square feet
plot(cleaned_data$MasVnrArea,cleaned_data$SalePrice)

# Scatter plot between Sales price &  Number of fireplaces
plot(cleaned_data$Fireplaces,cleaned_data$SalePrice)

# Scatter plot between Sales price & Open porch area in square feet
plot(cleaned_data$OpenPorchSF,cleaned_data$SalePrice)
```
#Step4: Cite, vlidate and fix the linear regression assumptions
# - For mutiplie linear regression check for (Mutivariate Linearity) i.e. linear combination of independent variable also follows a normal distribution that means Y should also follow a normal distribution
```{r}

#Make dependnet variable normally distributed using log transformation

trnsf_data = num_dataset
trnsf_data['SalePrice'] = log(trnsf_data$SalePrice)

# Visualize the dependent variable and check its skewness abd Kurtosis (After transformation)
hist(trnsf_data$SalePrice,main = "Histogram of Log Transformed Sales Price", xlab = "Sales Price")
skewness(trnsf_data$SalePrice)
kurtosis(trnsf_data$SalePrice)

qqnorm(trnsf_data$SalePrice,main = "Q-Q plot of Log Transfomed Sales Price")
qqline(trnsf_data$SalePrice)

```
#Check for Homodesaticity i.e. residual should not follow any pattern - If residual has a pattern i.e. increasing, decreasing or any other non linear pattern than there is an issue of heteroscedencity

```{r}
# Scatter plot between Sales price & Above the ground area
RM = lm(trnsf_data$SalePrice~trnsf_data$GrLivArea+trnsf_data$GarageArea)
y.hat = fitted(RM)
e = resid(RM)
plot(x=trnsf_data$GrLivArea,y=e,xlab = 'GrLivArea',ylab = 'Residual')
abline(0,0)

plot(x=trnsf_data$GarageArea,y=e,xlab = 'GarageArea',ylab = 'Residual')
abline(0,0)

plot(x=y.hat,y=e,xlab = 'Predicted Value',ylab = 'Residual')
abline(0,0)

plot(x=trnsf_data$SalePrice,y=e,xlab = 'Actual Value',ylab = 'Residual')

plot(x=trnsf_data$SalePrice,y=y.hat, xlab = 'Actual Value',ylab = 'Predicted Value', col =  c("black", "green"))
#text(trnsf_data$SalePrice~y.hat, labels=round(y.hat,2))

```
# One of the assumption in linear regression is that predictors variables are independet of each other or there is minimal correlation with others. This is also known as issue of Multicollinearity

```{r}
corrplot(corr,type ='lower',method = 'number',order ='FPC',tl.col = 'black',number.cex = 0.5)

```
# Step4: Delete features that are highly correlated with others to achieve minimum or no multicollinearity  
# - Use Corelation Matrix
# - Use VIF
```{r}

# Scatter plot between Sales price & Open porch area in square feet
#plot(log(trns_num_data$BsmtFinSF2),trns_num_data$SalePrice)

lm_model = lm(SalePrice~GrLivArea+OverallQual+GarageCars+TotalBsmtSF+YearBuilt+YearRemodAdd+Fireplaces,trnsf_data)
summary(lm_model)
vif(lm_model)
```

# Step 5: Working on the categorical data 
```{r}


```

